<!doctype html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org" class="h-100">
<head th:insert="blocks/includes :: header"></head>
<body class="bg-dark d-flex flex-column h-100">
<nav th:replace="blocks/header :: header"></nav>
<div class="container">
    <div class="card bg-secondary">
        <div class="card-header text-center d-flex flex-row justify-content-center">
                <h5 class="display-5">Логи за дату:</h5>
                <h5 class="display-5" id="date"></h5>
        </div>
        <div class="card-body d-flex flex-column">
            <div class="d-flex flex-row justify-content-between">
                <h5>Людей собрало прибыль 1-3 раза</h5>
                <h5 id="PCIOTTT">123</h5>
            </div>
            <div class="d-flex flex-row justify-content-between">
                <h5>Людей собрало прибыль больше 3 раз</h5>
                <h5 id="PCIMT">123</h5>
            </div>
            <div class="d-flex flex-row justify-content-between">
                <h5>Людей выполнило ежедневное задание</h5>
                <h5 id="PCDT">123</h5>
            </div>
            <div class="d-flex flex-row justify-content-between">
                <h5>Людей отправило хотя бы 1 стикер</h5>
                <h5 id="PSSOOMT">123</h5>
            </div>
            <div class="d-flex flex-row justify-content-between">
                <h5>Людей задонатило</h5>
                <h5 id="PD">123</h5>
            </div>
            <div class="d-flex flex-row justify-content-between">
                <h5>Людей выставило стикер на аукцион</h5>
                <h5 id="PPSTA">123</h5>
            </div>
        </div>
        <div class="card-footer text-center btn-group">
            <button class="btn border-dark text-dark" onclick="increaseDate()">Вперед</button>
            <button class="btn border-dark text-dark" onclick="decreaseDate()">Назад</button>
        </div>
    </div>
</div>
<footer th:replace="blocks/footer :: footer"></footer>
<div th:replace="blocks/includes :: footer"></div>
<script>
    /*<![CDATA[*/
    let date = new Date(Date.now())
    let dateEl = $('#date')
    let host = '[[${host}]]'
    let port = '[[${port}]]'
    dateEl.text(date.toLocaleDateString())
    loadData()

    function increaseDate(){
        date.setDate(date.getDate() + 1)
        setPlaceholders()
        loadData()
    }

    function decreaseDate(){
        date.setDate(date.getDate() - 1)
        setPlaceholders()
        loadData()
    }

    function loadData(){
        $.ajax({
            method: 'POST',
            data: {dateStr: date.toLocaleDateString()},
            url: 'http://'+host+':'+port+'/database/logs',
            contentType: "application/json",
            success: (data)=>{
                console.log(data)
                let result = JSON.parse(JSON.stringify(data));
                updateData(result)
                removePlaceholders()
            }
        })
    }

    function setPlaceholders(){
        dateEl.addClass('placeholder')
        $('#PCIOTTT').addClass('placeholder')
        $('#PCIMT').addClass('placeholder')
        $('#PCDT').addClass('placeholder')
        $('#PSSOOMT').addClass('placeholder')
        $('#PD').addClass('placeholder')
        $('#PPSTA').addClass('placeholder')
    }

    function updateData(data){
        dateEl.text(date.toLocaleDateString())
        console.log(data.pciottt)
        $('#PCIOTTT').text(data.pciottt)
        $('#PCIMT').text(data.pcimt)
        $('#PCDT').text(data.pcdt)
        $('#PSSOOMT').text(data.pssoomt)
        $('#PD').text(data.pd)
        $('#PPSTA').text(data.ppsta)
    }

    function removePlaceholders(){
        dateEl.removeClass('placeholder')
        $('#PCIOTTT').removeClass('placeholder')
        $('#PCIMT').removeClass('placeholder')
        $('#PCDT').removeClass('placeholder')
        $('#PSSOOMT').removeClass('placeholder')
        $('#PD').removeClass('placeholder')
        $('#PPSTA').removeClass('placeholder')
    }
    /*]]>*/
</script>
</body>
</html>